# B2: UX Decision Pack (Machine-Readable)
# SSW Galaxy MMO - Binding UX Decisions
# Version: 1.0
# Date: 2025-12-27
# Agent: UX Authority (Agent B)
# Purpose: Machine-readable UX constraints for automated validation (Agent C)

version: "1.0"
project: "SSW Galaxy MMO Frontend"
analysis_date: "2025-12-27"
binding: true  # All decisions are mandatory

# ============================================================
# ARCHITECTURE
# ============================================================
architecture:
  shell_paradigm: "persistent_cockpit"
  layers:
    - name: "hud_shell"
      persistence: "always_visible"
      components:
        - "status_bar"
        - "quick_action_hud"
        - "mini_map"
    - name: "viewport"
      persistence: "always_visible"
      behavior: "content_swap"
    - name: "panels"
      persistence: "contextual"
      behavior: "overlay_or_sidebar"

  navigation_model:
    primary: "bottom_tab_bar"
    primary_tab_count: 5
    primary_tabs:
      - "dashboard"
      - "map"
      - "missions"
      - "profile"
      - "feed"
    secondary: "in_context_actions"
    prohibited:
      - "navigation_stacks_deeper_than_2"
      - "context_switching_that_hides_hud"

# ============================================================
# FLASH-CARD UI RULES (Prohibited Patterns)
# ============================================================
flash_card_ui:
  definition: "centered modal dialog that obscures game world for core gameplay"

  prohibited_use_cases:
    - name: "jump_target_selection"
      current_violation: true
      file_pattern: "JumpDialog.tsx"
      correct_pattern: "inline_panel"
      priority: "P0"

    - name: "docking_confirmation"
      current_violation: true
      file_pattern: "DockingDialog.tsx"
      correct_pattern: "inline_panel"
      priority: "P1"

    - name: "combat_actions"
      current_violation: false
      correct_pattern: "viewport_replacement"

    - name: "inventory_transfer"
      current_violation: true
      file_pattern: "TransferModal.tsx"
      correct_pattern: "drag_and_drop_or_side_panel"
      priority: "P1"

    - name: "market_trading"
      current_violation: false
      correct_pattern: "viewport_replacement"

    - name: "mission_acceptance"
      current_violation: false
      correct_pattern: "inline_card"

  acceptable_use_cases:
    - "login_signup"  # Not in-game
    - "character_creation"  # One-time setup
    - "ship_creation"  # One-time setup
    - "settings_menu"  # Meta-game action
    - "critical_errors"  # System failure

# ============================================================
# HUD SHELL COMPONENTS
# ============================================================
hud_components:
  status_bar:
    position: "top"
    height_px:
      compact: 48
      comfortable: 60
    persistence: "always_visible"
    exceptions:
      - "login_screen"
      - "signup_screen"

    required_elements:
      - name: "ship_name"
        data_source: "GET /v1/ships/{ship_id}"
        update_method: "sse"
        sse_event: "game.ship.status"

      - name: "location"
        data_source: "GET /v1/sectors/{sector_id}"
        update_method: "sse"
        sse_event: "game.ship.location"

      - name: "fuel"
        data_source: "ship.fuel_current / ship.fuel_max"
        update_method: "sse"
        sse_event: "game.ship.fuel"
        visual_treatment:
          color_critical: "#FFAA00"
          threshold_critical: 0.20

      - name: "hull"
        data_source: "ship.hull_current / ship.hull_max"
        update_method: "sse"
        sse_event: "game.ship.hull"
        visual_treatment:
          color_critical: "#FF4444"
          color_damaged: "#FFAA00"
          color_healthy: "#44FF44"
          threshold_critical: 0.25
          threshold_damaged: 0.75

      - name: "shield"
        data_source: "ship.shield_current / ship.shield_max"
        update_method: "sse"
        sse_event: "game.ship.shield"
        visual_treatment:
          color_active: "#00AAFF"
          color_down: "#666666"

      - name: "credits"
        data_source: "GET /v1/characters/{id}"
        update_method: "sse"
        sse_event: "game.economy.credits_changed"

      - name: "missions_active"
        data_source: "GET /v1/missions/active"
        update_method: "sse"
        sse_event: "game.missions.accepted"

      - name: "alerts_unread"
        data_source: "event_feed.unread_count"
        update_method: "sse"
        sse_event: "game.notification.*"

    typography:
      font_family: "'Courier New', 'Monaco', monospace"
      font_size_compact: 12
      font_size_comfortable: 14

    background:
      color: "rgba(0, 0, 0, 0.8)"
      opacity: 0.8

  quick_action_hud:
    position: "floating_overlay"
    placement:
      - "top_right"
      - "bottom_right"
    visible_on_screens:
      - "map"
      - "sector_view"

    required_buttons:
      - name: "jump"
        icon: "rocket"
        label: "JUMP"
        action: "open_jump_panel"
        panel_type: "inline"

      - name: "dock"
        icon: "station"
        label: "DOCK"
        action: "open_dock_panel"
        panel_type: "inline"
        enabled_condition: "station_in_range"

      - name: "combat"
        icon: "combat"
        label: "COMBAT"
        action: "open_combat_interface"
        panel_type: "viewport_replacement"

      - name: "chat"
        icon: "chat"
        label: "CHAT"
        action: "toggle_chat_panel"
        panel_type: "side_panel"

    visual_treatment:
      background_opacity: 0.6
      touch_target_min_px: 44
      icon_size_px: 24

    behavior:
      - "buttons_expand_panels"
      - "no_navigation_route_changes"

  mini_map:
    position: "top_right"
    size_px:
      mobile: 100
      tablet: 120
      desktop: 150
    visible_on_screens:
      - "map"
      - "sector_view"

    data_source: "GET /v1/sectors/{sector_id}"
    update_method: "sse"
    sse_event: "game.ship.location"
    update_frequency_max_sec: 1

    elements:
      - name: "current_sector"
        icon: "center_dot"
        color: "#00AAFF"
      - name: "nearby_sectors"
        icon: "dimmed_dots"
        color: "#666666"
      - name: "stations"
        icon: "yellow_icon"
        color: "#FFFF00"
      - name: "npcs_hostile"
        icon: "red_dot"
        color: "#FF4444"
      - name: "npcs_friendly"
        icon: "green_dot"
        color: "#44FF44"

    interaction:
      tap_action: "open_full_map_screen"
      pan_enabled: false
      zoom_enabled: false

# ============================================================
# PANEL SYSTEM
# ============================================================
panels:
  types:
    - name: "side_panel"
      width_px:
        compact: 240
        comfortable: 320
      behavior: "collapsible"
      responsive:
        mobile_portrait: "full_screen_overlay"
        mobile_landscape: "overlay"
        tablet: "sidebar"
        desktop: "sidebar"

    - name: "bottom_panel"
      height_px:
        min: 200
        max: 300
      behavior: "slides_from_bottom"
      dismissible: true
      dismiss_gesture: "swipe_down"

    - name: "inline_panel"
      behavior: "embedded_in_viewport"
      dismissible: true
      dismiss_action: "cancel_button"

  panel_definitions:
    - name: "chat_panel"
      type: "side_panel"
      position: "right"
      priority: "P0"
      current_status: "missing"

      required_elements:
        - "room_tabs"  # Sector, Faction, DM
        - "message_list"
        - "input_field"
        - "send_button"

      data_sources:
        - "GET /v1/chat/rooms"
        - "POST /v1/chat/messages"

      sse_events:
        - "game.chat.message"

      behavior:
        - "auto_join_sector_chat_on_jump"
        - "unread_count_in_collapsed_state"
        - "message_history_persists"

    - name: "inventory_panel"
      type: "side_panel"
      position: "left"
      priority: "P1"
      current_status: "partial"

      required_elements:
        - "category_tabs"
        - "resource_list"
        - "total_value_summary"

      data_sources:
        - "GET /v1/characters/{id}/inventory"

      interaction:
        - "tap_resource_show_details"
        - "drag_drop_to_transfer"

    - name: "jump_panel"
      type: "inline_panel"
      embedded_in: "map_screen"
      priority: "P0"
      current_status: "violation"  # Currently a modal
      migration_required: true

      required_elements:
        - "target_sector_display"
        - "distance_display"
        - "fuel_cost_display"
        - "cooldown_status"
        - "cancel_button"
        - "confirm_button"

      data_sources:
        - "POST /v1/actions/jump"
        - "GET /v1/ships/{id}"

      behavior:
        - "map_remains_visible_dimmed"
        - "slides_from_bottom"
        - "cancel_dismisses_panel"

    - name: "docking_panel"
      type: "inline_panel"
      embedded_in: "sector_view_screen"
      priority: "P1"
      current_status: "violation"  # Currently a modal
      migration_required: true

      required_elements:
        - "station_name"
        - "services_available"
        - "cancel_button"
        - "dock_button"

      data_sources:
        - "POST /v1/actions/dock"

      behavior:
        - "sector_view_remains_visible_dimmed"
        - "slides_from_bottom"
        - "enabled_when_station_in_range"

    - name: "combat_log_panel"
      type: "bottom_panel"
      priority: "P1"
      current_status: "implemented"

      required_elements:
        - "action_log_list"
        - "scroll_to_latest"

      sse_events:
        - "game.combat.action"

      behavior:
        - "shows_last_10_actions"
        - "auto_scroll_to_latest"
        - "collapsible"

# ============================================================
# REAL-TIME SSE INTEGRATION
# ============================================================
sse_integration:
  event_to_ui_mapping:
    - event: "game.ship.location"
      components:
        - "status_bar.location"
        - "mini_map.position"
      update_type: "immediate"

    - event: "game.ship.fuel"
      components:
        - "status_bar.fuel"
      update_type: "immediate"

    - event: "game.ship.hull"
      components:
        - "status_bar.hull"
      update_type: "immediate"

    - event: "game.ship.shield"
      components:
        - "status_bar.shield"
      update_type: "immediate"

    - event: "game.combat.start"
      components:
        - "viewport"
      update_type: "viewport_replacement"

    - event: "game.combat.action"
      components:
        - "combat_log_panel"
      update_type: "append_log_entry"

    - event: "game.combat.outcome"
      components:
        - "viewport"
        - "status_bar"
      update_type: "restore_map_and_update_hp"

    - event: "game.combat.loot"
      components:
        - "inventory_panel"
        - "notification_system"
      update_type: "add_items_and_notify"

    - event: "game.economy.order_filled"
      components:
        - "event_feed"
        - "status_bar.credits"
      update_type: "credits_update_and_feed_entry"

    - event: "game.missions.accepted"
      components:
        - "status_bar.missions_active"
        - "mission_list"
      update_type: "increment_count_and_list_update"

    - event: "game.missions.completed"
      components:
        - "status_bar.missions_active"
        - "event_feed"
      update_type: "decrement_count_and_notification"

    - event: "game.chat.message"
      components:
        - "chat_panel"
      update_type: "append_message_and_badge"

    - event: "game.station.docked"
      components:
        - "viewport"
      update_type: "show_station_services"

    - event: "game.station.undocked"
      components:
        - "viewport"
      update_type: "restore_sector_view"

  notification_levels:
    - level: "critical"
      treatment: "full_screen_overlay_with_dismiss"
      duration_ms: "user_dismiss"
      events:
        - "game.combat.start"

    - level: "important"
      treatment: "toast_bottom"
      duration_ms: 5000
      events:
        - "game.combat.outcome"
        - "game.missions.completed"

    - level: "informational"
      treatment: "event_feed_only"
      duration_ms: null
      events:
        - "game.economy.order_filled"
        - "game.chat.message"

# ============================================================
# DESIGN TOKENS
# ============================================================
design_tokens:
  colors:
    semantic:
      hull_critical: "#FF4444"
      hull_damaged: "#FFAA00"
      hull_healthy: "#44FF44"
      shield_active: "#00AAFF"
      shield_down: "#666666"
      fuel_low: "#FFAA00"
      fuel_ok: "#FFFF00"

    ui_elements:
      hud_background: "rgba(0, 0, 0, 0.8)"
      panel_background: "rgba(20, 20, 30, 0.95)"
      button_primary: "#00AAFF"
      button_danger: "#FF4444"
      text_primary: "#FFFFFF"
      text_secondary: "#AAAAAA"
      text_accent: "#00FFAA"

    factions:
      terran_federation: "#0066CC"
      martian_collective: "#CC3300"
      belter_alliance: "#996600"
      jovian_republic: "#CC6600"
      corporate_syndicate: "#666666"
      pirate_clans: "#990000"
      independent_traders: "#009900"
      research_coalition: "#9900CC"
      military_junta: "#003300"
      frontier_settlers: "#CCAA00"

  typography:
    families:
      hud_font: "'Courier New', 'Monaco', monospace"
      ui_font: "'Roboto', 'Helvetica Neue', sans-serif"
      title_font: "'Orbitron', 'Exo 2', sans-serif"

    sizes_compact:
      hud_stat: 12
      hud_label: 10
      panel_body: 14
      panel_heading: 16
      button_text: 14

    sizes_comfortable:
      hud_stat: 14
      hud_label: 12
      panel_body: 16
      panel_heading: 18
      button_text: 16

  spacing:
    base_unit: 4
    scale:
      xs: 4
      sm: 8
      md: 16
      lg: 24
      xl: 32

# ============================================================
# ACCESSIBILITY
# ============================================================
accessibility:
  touch_targets:
    min_size_px: 44
    applies_to:
      - "all_buttons"
      - "tab_bar_icons"
      - "status_bar_tap_targets"
      - "list_items"

  contrast:
    min_ratio: 4.5  # WCAG AA
    applies_to:
      - "status_bar_text"
      - "panel_text"
      - "button_text"
    exceptions:
      - element: "decorative_elements"
        min_ratio: 3.0

  reduced_motion:
    respect_os_setting: true
    behaviors:
      panel_transitions: "instant"
      sse_feedback: "static_highlight_only"
      button_press: "opacity_only"

# ============================================================
# ANIMATION
# ============================================================
animations:
  panel_transitions:
    open_close:
      duration_ms: 200
      easing: "ease-out"
      effect: "slide_from_edge"

    collapse_expand:
      duration_ms: 150
      easing: "ease-in-out"
      effect: "width_height_transition"

  state_transitions:
    sse_feedback:
      duration_ms: 100
      effect: "pulse_or_glow"

    button_press:
      duration_ms: 50
      effect: "scale_95_opacity_80"

    critical_alerts:
      duration_ms: 300
      effect: "fade_in_slide_up"

# ============================================================
# RESPONSIVE BREAKPOINTS
# ============================================================
responsive:
  breakpoints:
    - name: "mobile_portrait"
      width_min: 320
      width_max: 480
      status_bar_mode: "compact"
      panels_mode: "full_screen_overlays"
      mini_map_visible: false
      tab_bar_mode: "icons_only"

    - name: "mobile_landscape"
      width_min: 481
      width_max: 768
      status_bar_mode: "compact_or_comfortable"
      panels_mode: "bottom_panels_only"
      mini_map_size_px: 100
      tab_bar_mode: "icons_and_text"

    - name: "tablet_portrait"
      width_min: 769
      width_max: 1024
      status_bar_mode: "comfortable"
      panels_mode: "side_panels_visible"
      mini_map_size_px: 120
      tab_bar_mode: "icons_and_text"

    - name: "tablet_landscape_desktop"
      width_min: 1025
      width_max: null
      status_bar_mode: "comfortable"
      panels_mode: "side_and_bottom_simultaneously"
      mini_map_size_px: 150
      tab_bar_mode: "icons_and_text"

# ============================================================
# VALIDATION RULES (for Agent C)
# ============================================================
validation:
  flash_card_detection:
    scan_for_components:
      - "Modal"
      - "Dialog"
      - "Popup"
    exclude_files:
      - "LoginScreen.tsx"
      - "SignupScreen.tsx"
      - "CharacterCreateScreen.tsx"
      - "ShipCustomizeScreen.tsx"
      - "SettingsModal.tsx"
    failure_condition: "flash_card_found_in_core_gameplay"

  sse_event_coverage:
    required_events: 20
    handler_check: "all_events_have_handlers"
    failure_condition: "missing_handlers"

  hud_visibility:
    required_on_screens:
      - "dashboard"
      - "map"
      - "missions"
      - "profile"
      - "feed"
      - "sector_view"
      - "combat"
    failure_condition: "status_bar_not_rendered"

  touch_target_size:
    min_size_px: 44
    test_type: "automated_detox"
    failure_condition: "buttons_smaller_than_44px"

  color_token_usage:
    lint_for: "hardcoded_hex_colors"
    allowed_patterns:
      - "theme.colors.*"
      - "designTokens.colors.*"
    failure_condition: "hardcoded_colors_found"

# ============================================================
# MIGRATION PLAN
# ============================================================
migration:
  current_violations:
    - name: "jump_dialog_modal"
      file: "JumpDialog.tsx"
      target_pattern: "inline_panel"
      priority: "P0"
      effort_days: 1

    - name: "docking_dialog_modal"
      file: "DockingDialog.tsx"
      target_pattern: "inline_panel"
      priority: "P1"
      effort_days: 1

    - name: "transfer_modal"
      file: "TransferModal.tsx"
      target_pattern: "drag_drop_or_side_panel"
      priority: "P1"
      effort_days: 1

    - name: "no_status_bar"
      target_pattern: "add_status_bar"
      priority: "P0"
      effort_days: 2

    - name: "no_mini_map"
      target_pattern: "add_mini_map"
      priority: "P1"
      effort_days: 1

    - name: "no_chat_panel"
      target_pattern: "add_chat_panel"
      priority: "P0"
      effort_days: 3

    - name: "polling_instead_of_sse"
      target_pattern: "migrate_to_sse"
      priority: "P1"
      effort_days: 2

  sequential_steps:
    - step: 1
      action: "add_status_bar"
      breaking: false

    - step: 2
      action: "add_quick_action_hud"
      breaking: false

    - step: 3
      action: "refactor_jump_modal_to_panel"
      breaking: true

    - step: 4
      action: "refactor_docking_modal_to_panel"
      breaking: true

    - step: 5
      action: "add_chat_panel"
      breaking: false

    - step: 6
      action: "add_mini_map"
      breaking: false

    - step: 7
      action: "migrate_to_sse"
      breaking: false

# ============================================================
# SUCCESS METRICS
# ============================================================
metrics:
  performance:
    panel_open_close_ms: 200
    sse_event_to_ui_update_ms: 100
    status_bar_update_delay_ms: 0
    mini_map_update_max_sec: 1

  ux_compliance:
    flash_card_ui_instances: 0
    hud_visibility_percent: 100
    sse_event_coverage_percent: 100
    touch_target_compliance_percent: 100

  business:
    session_duration_increase_percent: 20
    chat_engagement_increase_percent: 300
    combat_completion_increase_percent: 15
    churn_rate_decrease_percent: 15
