FORMAT: 1A
HOST: http://192.168.122.76:8080/v1

# SSW Galaxy MMO - Social System (vNext 2.0)

**Version**: 2.0 (vNext)
**Status**: Implementation-Grounded
**Last Verified**: 2025-12-27
**Service**: Social (Internal Port: 8085)

---

## Document Purpose

This document covers the **Social Service**, responsible for:
- **Factions**: Major political/corporate factions
- **Reputation**: Player standing with factions
- **Influence**: Faction control of sectors
- **Territory**: Faction-controlled space

**Code**: `/services/social/`

**Related Documents**:
- See `01-OVERVIEW.apib` for global standards
- See `06-APPENDICES.md` for faction list and reputation tiers
- See `04-REALTIME-SSE.apib` for reputation change events

---

## Factions

### GET /v1/factions

List all factions in the galaxy.

**Authentication**: Optional (public data)

**Response** (200 OK):
```json
{
  "data": [
    {
      "id": "terran_federation",
      "name": "Terran Federation",
      "description": "The unified government of humanity, focused on expansion and diplomacy.",
      "color": "#3B82F6",
      "emblem": "terran_emblem",
      "home_system": "sol",
      "member_count": 1000000,
      "founded": "2150-01-01T00:00:00Z",
      "is_playable": true
    },
    {
      "id": "void_consortium",
      "name": "Void Consortium",
      "description": "A powerful corporate alliance controlling major trade routes.",
      "color": "#10B981",
      "emblem": "consortium_emblem",
      "home_system": "nexus_prime",
      "member_count": 500000,
      "founded": "2180-01-01T00:00:00Z",
      "is_playable": true
    },
    {
      "id": "stellar_imperium",
      "name": "Stellar Imperium",
      "description": "An ancient empire with advanced technology and strict hierarchy.",
      "color": "#EF4444",
      "emblem": "imperium_emblem",
      "home_system": "throne_world",
      "member_count": 750000,
      "founded": "2100-01-01T00:00:00Z",
      "is_playable": true
    },
    {
      "id": "free_traders",
      "name": "Free Traders Guild",
      "description": "Independent merchants and explorers operating outside faction control.",
      "color": "#F59E0B",
      "emblem": "traders_emblem",
      "home_system": "freeport",
      "member_count": 250000,
      "founded": "2200-01-01T00:00:00Z",
      "is_playable": true
    }
  ]
}
```

**Field Descriptions**:
- `color`: Hex color code for UI representation
- `emblem`: Asset identifier for faction symbol
- `member_count`: Active player count (updated hourly)
- `is_playable`: Whether players can join faction

**Code**: `/services/social/cmd/main.go:133-180` (faction definitions)

---

### GET /v1/factions/{faction_id}

Get detailed information about a specific faction.

**Authentication**: Optional

**URL Parameters**:
- `faction_id` (required): Faction ID

**Response** (200 OK):
```json
{
  "data": {
    "id": "terran_federation",
    "name": "Terran Federation",
    "description": "The unified government of humanity, focused on expansion and diplomacy.",
    "color": "#3B82F6",
    "emblem": "terran_emblem",
    "home_system": "sol",
    "member_count": 1000000,
    "founded": "2150-01-01T00:00:00Z",
    "is_playable": true,
    "controlled_sectors": 1452,
    "total_influence": 25.4,
    "capital_sector": "0,0,0"
  }
}
```

**Error Codes**:
- `FACTION_NOT_FOUND` (404) - Faction does not exist

**Code**: `/services/social/internal/handlers/faction.go:85-130`

---

### GET /v1/factions/{faction_id}/members

Get list of players in a faction.

**Authentication**: Required

**URL Parameters**:
- `faction_id` (required): Faction ID

**Query Parameters**:
- `limit` (optional): Number of members (default: 20, max: 100)
- `offset` (optional): Pagination offset (default: 0)

**Response** (200 OK):
```json
{
  "data": {
    "items": [
      {
        "player_id": "player-uuid-1",
        "player_name": "Captain Nova",
        "reputation": 850,
        "reputation_tier": "Honored",
        "joined_at": "2025-12-01T10:00:00Z",
        "rank": "Commander"
      },
      {
        "player_id": "player-uuid-2",
        "player_name": "Commander Atlas",
        "reputation": 450,
        "reputation_tier": "Friendly",
        "joined_at": "2025-12-15T14:30:00Z",
        "rank": "Lieutenant"
      }
    ],
    "total": 1000000,
    "limit": 20,
    "offset": 0
  }
}
```

**Field Descriptions**:
- `rank`: Faction-specific rank based on reputation

**Error Codes**:
- `FACTION_NOT_FOUND` (404) - Faction does not exist
- `AUTH_REQUIRED` (401) - Missing or invalid authentication token

**Code**: `/services/social/internal/handlers/faction.go:135-190`

---

### GET /v1/factions/{faction_id}/relations

Get diplomatic relations between this faction and others.

**Authentication**: Optional

**URL Parameters**:
- `faction_id` (required): Faction ID

**Response** (200 OK):
```json
{
  "data": [
    {
      "target_faction_id": "void_consortium",
      "target_faction_name": "Void Consortium",
      "relation_type": "friendly",
      "standing": 50
    },
    {
      "target_faction_id": "stellar_imperium",
      "target_faction_name": "Stellar Imperium",
      "relation_type": "hostile",
      "standing": -30
    },
    {
      "target_faction_id": "free_traders",
      "target_faction_name": "Free Traders Guild",
      "relation_type": "neutral",
      "standing": 10
    }
  ]
}
```

**Relation Types**:
- `allied`: Strong positive relationship (standing 75-100)
- `friendly`: Positive relationship (standing 25-74)
- `neutral`: No strong relationship (standing -24 to 24)
- `unfriendly`: Negative relationship (standing -74 to -25)
- `hostile`: Strong negative relationship (standing -100 to -75)

**Usage**: Affects missions, trade prices, sector access

**Error Codes**:
- `FACTION_NOT_FOUND` (404) - Faction does not exist

**Code**: `/services/social/internal/handlers/faction.go:195-240`

---

## Reputation

### GET /v1/players/{player_id}/reputation

Get all faction reputations for a player.

**Authentication**: Required

**URL Parameters**:
- `player_id` (required): Profile ID

**Response** (200 OK):
```json
{
  "data": [
    {
      "faction_id": "terran_federation",
      "faction_name": "Terran Federation",
      "reputation": 850,
      "reputation_tier": "Honored",
      "tier_min": 751,
      "tier_max": 1000,
      "progress_to_next": 0.66
    },
    {
      "faction_id": "void_consortium",
      "faction_name": "Void Consortium",
      "reputation": 450,
      "reputation_tier": "Friendly",
      "tier_min": 251,
      "tier_max": 500,
      "progress_to_next": 0.80
    },
    {
      "faction_id": "stellar_imperium",
      "faction_name": "Stellar Imperium",
      "reputation": -200,
      "reputation_tier": "Neutral",
      "tier_min": -250,
      "tier_max": 250,
      "progress_to_next": 0.10
    }
  ]
}
```

**Field Descriptions**:
- `reputation`: Current reputation value (-1000 to 1000)
- `reputation_tier`: Tier name (see `06-APPENDICES.md` for tiers)
- `progress_to_next`: Progress toward next tier (0.0 to 1.0)

**Error Codes**:
- `NOT_FOUND` (404) - Player does not exist
- `AUTH_REQUIRED` (401) - Missing or invalid authentication token

**Code**: `/services/social/internal/handlers/reputation.go:25-80`

---

### GET /v1/players/{player_id}/reputation/{faction_id}

Get player's reputation with a specific faction.

**Authentication**: Required

**URL Parameters**:
- `player_id` (required): Profile ID
- `faction_id` (required): Faction ID

**Response** (200 OK):
```json
{
  "data": {
    "faction_id": "terran_federation",
    "faction_name": "Terran Federation",
    "reputation": 850,
    "reputation_tier": "Honored",
    "tier_min": 751,
    "tier_max": 1000,
    "progress_to_next": 0.66,
    "benefits": [
      "15% discount on station services",
      "Access to rare missions",
      "Faction ship unlocked"
    ]
  }
}
```

**Error Codes**:
- `NOT_FOUND` (404) - Player or faction does not exist
- `AUTH_REQUIRED` (401) - Missing or invalid authentication token

**Code**: `/services/social/internal/handlers/reputation.go:85-130`

---

### GET /v1/players/{player_id}/reputation/history

Get reputation change history for a player.

**Authentication**: Required

**URL Parameters**:
- `player_id` (required): Profile ID

**Query Parameters**:
- `faction_id` (optional): Filter by faction
- `limit` (optional): Number of events (default: 20, max: 100)

**Response** (200 OK):
```json
{
  "data": {
    "events": [
      {
        "event_id": "event-uuid-1",
        "faction_id": "terran_federation",
        "faction_name": "Terran Federation",
        "change": 50,
        "old_reputation": 800,
        "new_reputation": 850,
        "reason": "Mission completed: Clear Pirate Threat",
        "timestamp": "2025-12-27T12:34:56.123456Z"
      },
      {
        "event_id": "event-uuid-2",
        "faction_id": "stellar_imperium",
        "faction_name": "Stellar Imperium",
        "change": -25,
        "old_reputation": -175,
        "new_reputation": -200,
        "reason": "Killed faction NPC",
        "timestamp": "2025-12-27T11:15:00.123456Z"
      }
    ],
    "total": 142,
    "limit": 20
  }
}
```

**Change Reasons**:
- `Mission completed: {mission_name}`
- `Delivered high-quality resources`
- `Killed faction NPC`
- `Traded at faction market`
- `Mission abandoned`

**Error Codes**:
- `NOT_FOUND` (404) - Player does not exist
- `AUTH_REQUIRED` (401) - Missing or invalid authentication token

**Code**: `/services/social/internal/handlers/reputation.go:135-190`

---

### POST /v1/reputation/actions

Apply a reputation change (internal service call, not for players).

**Authentication**: Required (service-to-service)

**Request Body**:
```json
{
  "player_id": "player-uuid-1",
  "faction_id": "terran_federation",
  "change": 50,
  "reason": "Mission completed: Clear Pirate Threat",
  "source_service": "missions"
}
```

**Response** (200 OK):
```json
{
  "data": {
    "success": true,
    "old_reputation": 800,
    "new_reputation": 850,
    "old_tier": "Honored",
    "new_tier": "Honored",
    "tier_changed": false
  }
}
```

**NATS Event Published** (if tier changed):
- Channel: `game.social.reputation`, `player.{player_id}`
- Event Type: `game.social.reputation`

**Error Codes**:
- `NOT_FOUND` (404) - Player or faction does not exist
- `VALIDATION_ERROR` (400) - Invalid request body
- `AUTH_REQUIRED` (401) - Missing or invalid authentication token

**Code**: `/services/social/internal/handlers/reputation.go:195-250`

---

### GET /v1/reputation/tiers

Get reputation tier definitions.

**Authentication**: Optional (public data)

**Response** (200 OK):
```json
{
  "data": {
    "tiers": [
      {
        "tier": "Exalted",
        "min": 751,
        "max": 1000,
        "color": "#FFD700",
        "benefits": [
          "Max discounts (20%)",
          "Exclusive missions",
          "Faction ships unlocked"
        ]
      },
      {
        "tier": "Honored",
        "min": 501,
        "max": 750,
        "color": "#9D4EDD",
        "benefits": [
          "High discounts (15%)",
          "Rare missions"
        ]
      },
      {
        "tier": "Friendly",
        "min": 251,
        "max": 500,
        "color": "#10B981",
        "benefits": [
          "Moderate discounts (10%)",
          "Special missions"
        ]
      },
      {
        "tier": "Neutral",
        "min": -250,
        "max": 250,
        "color": "#6B7280",
        "benefits": [
          "Standard prices",
          "Basic missions"
        ]
      },
      {
        "tier": "Unfriendly",
        "min": -500,
        "max": -251,
        "color": "#F59E0B",
        "benefits": [
          "Price markup (10%)",
          "Limited access"
        ]
      },
      {
        "tier": "Hostile",
        "min": -750,
        "max": -501,
        "color": "#EF4444",
        "benefits": [
          "Price markup (25%)",
          "KOS in faction space"
        ]
      },
      {
        "tier": "Hated",
        "min": -1000,
        "max": -751,
        "color": "#991B1B",
        "benefits": [
          "Cannot dock at faction stations",
          "Attacked on sight"
        ]
      }
    ]
  }
}
```

**Code**: `/services/social/internal/handlers/reputation.go:255-300`

---

## Influence

### GET /v1/sectors/{sector_id}/influence

Get faction influence distribution in a sector.

**Authentication**: Optional

**URL Parameters**:
- `sector_id` (required): Sector coordinates (format: `x,y,z`)

**Response** (200 OK):
```json
{
  "data": {
    "sector_id": "0,0,0",
    "sector_name": "Sol System",
    "controller": "terran_federation",
    "contested": false,
    "influence": {
      "terran_federation": 85.0,
      "void_consortium": 10.0,
      "free_traders": 5.0
    },
    "last_updated": "2025-12-27T12:00:00Z"
  }
}
```

**Field Descriptions**:
- `controller`: Faction with majority control (>50%)
- `contested`: True if no faction has >50% influence
- `influence`: Map of faction IDs to influence percentage (sum = 100%)
- `last_updated`: Influence recalculated every 30 minutes

**Influence Calculation Factors**:
- Player population in sector (40% weight)
- Active ships in sector (30% weight)
- Trade volume in sector (20% weight)
- Missions completed in sector (10% weight)

**Error Codes**:
- `SECTOR_NOT_FOUND` (404) - Sector does not exist
- `VALIDATION_ERROR` (400) - Invalid sector coordinates

**Code**: `/services/social/internal/handlers/influence.go:25-80`

---

### GET /v1/factions/{faction_id}/territory

Get all sectors controlled by a faction.

**Authentication**: Optional

**URL Parameters**:
- `faction_id` (required): Faction ID

**Response** (200 OK):
```json
{
  "data": {
    "faction_id": "terran_federation",
    "faction_name": "Terran Federation",
    "total_sectors": 1452,
    "sectors": [
      {
        "sector_id": "0,0,0",
        "sector_name": "Sol System",
        "influence": 85.0,
        "contested": false,
        "population": 1000000,
        "stations": 4
      },
      {
        "sector_id": "1,0,0",
        "sector_name": "Alpha Centauri",
        "influence": 72.0,
        "contested": false,
        "population": 500000,
        "stations": 3
      },
      {
        "sector_id": "5,2,-3",
        "sector_name": "Border Sector",
        "influence": 55.0,
        "contested": true,
        "population": 50000,
        "stations": 1
      }
    ]
  }
}
```

**Sorting**: Sectors sorted by influence (descending)

**Error Codes**:
- `FACTION_NOT_FOUND` (404) - Faction does not exist

**Code**: `/services/social/internal/handlers/influence.go:85-140`

---

### GET /v1/galaxy/influence-map

Get galaxy-wide influence map (all sectors).

**Authentication**: Optional

**Query Parameters**:
- `min_x`, `max_x`, `min_y`, `max_y`, `min_z`, `max_z` (optional): Bounding box filter

**Response** (200 OK):
```json
{
  "data": {
    "sectors": [
      {
        "sector_id": "0,0,0",
        "controller": "terran_federation",
        "influence": 85.0
      },
      {
        "sector_id": "1,0,0",
        "controller": "terran_federation",
        "influence": 72.0
      },
      {
        "sector_id": "10,5,-2",
        "controller": "void_consortium",
        "influence": 65.0
      }
    ],
    "total_sectors": 5824,
    "faction_summary": {
      "terran_federation": 1452,
      "void_consortium": 1123,
      "stellar_imperium": 987,
      "free_traders": 645,
      "contested": 1617
    }
  }
}
```

**Performance Note**: Large result set (5000+ sectors), consider using bounding box

**Error Codes**:
- `VALIDATION_ERROR` (400) - Invalid bounding box parameters

**Code**: `/services/social/internal/handlers/influence.go:145-200`

---

## Summary

This document covers the **Social Service**:

### Factions
1. **GET /v1/factions**: List all factions
2. **GET /v1/factions/{faction_id}**: Get faction details
3. **GET /v1/factions/{faction_id}/members**: Get faction members (paginated)
4. **GET /v1/factions/{faction_id}/relations**: Get diplomatic relations

### Reputation
5. **GET /v1/players/{player_id}/reputation**: Get all faction reputations
6. **GET /v1/players/{player_id}/reputation/{faction_id}**: Get specific faction reputation
7. **GET /v1/players/{player_id}/reputation/history**: Get reputation change history
8. **POST /v1/reputation/actions**: Apply reputation change (service-to-service)
9. **GET /v1/reputation/tiers**: Get tier definitions

### Influence
10. **GET /v1/sectors/{sector_id}/influence**: Get sector influence distribution
11. **GET /v1/factions/{faction_id}/territory**: Get faction-controlled sectors
12. **GET /v1/galaxy/influence-map**: Get galaxy-wide influence map

**Key Features**:
- **4 Playable Factions**: Terran Federation, Void Consortium, Stellar Imperium, Free Traders Guild
- **7 Reputation Tiers**: Hated (-1000) to Exalted (1000)
- **Dynamic Influence**: Recalculated every 30 minutes based on player activity
- **Faction Relations**: Allied, friendly, neutral, unfriendly, hostile
- **Reputation Benefits**: Discounts, missions, faction ships

**Critical Note**:
- 10+ endpoints documented here were **completely missing** from API-BLUEPRINT.md v1.2

**Next Steps**:
- Read `06-APPENDICES.md` for complete faction list and reputation tiers
- Read `03E-MISSIONS.apib` for faction missions
- Read `04-REALTIME-SSE.apib` for reputation change events

---

**End of 03F-SOCIAL.apib**
